<MediaInput>
  <div id="mediaInput">
    <h3>Media Link: </h3>
    <form>
      <div name="mediaType">{mediaType}</div>
      <input placeholder="URL to media" name="link" oninput={readLink}></input><br />


      <audio if={ mediaType=="audio"} name="audioElement" controls=1 src={this.link.value} ontimeupdate={timeUpdate} ></audio><br />
      <video if={ mediaType=="video"} name="videoElement" controls=1 src={this.link.value} ontimeupdate={timeUpdate} ></video><br />
      <div if={ mediaType=="youtube"} id="player"></div>
      <div id="subtitles">
        <div id="subs-in-lang-1">{subs}</div>
      </div>
      <div id="playerControls">
        <button id="prevButton" class="playerNav" onclick={prevClicked}>Prev</button>
        <button id="repeatButton" class="playerNav" onclick={repeatClicked}>Repeat</button>
        <button id="nextButton" class="playerNav" onclick={nextClicked}>Next</button>
        <div class="playerNav">{currentPhraseNum}</div>
      </div>

      <div id="currentTime">{ct}</div>
      <button onclick={setTiming}>Add time interval</button>
    </form>
  </div>

  <script>
    var tag = this
    tag.mediaType = ""
    tag.currentPhrase = 1

    tag.readLink = function() {
      //tag.media = tag.root.querySelector("#media")

      tag.mediaType = Media.type(tag.link.value)
      if ( (tag.mediaType == 'audio') || (tag.mediaType == 'video') )
        Media.setMedia(tag[tag.mediaType + "Element"])
      if ( tag.mediaType == 'youtube')
        Youtube.loadYoutubeApi()

    }

    tag.timeUpdate = function() {
      tag.ct = Media.getCurrentTime().toFixed(2)
    }

    tag.setTiming = function() {
      var curPhraseNum = Phrases.getCurrentPhraseNum()
      var prevPhrase = Phrases.getPhrase(curPhraseNum - 1)

      if(curPhraseNum > Phrases.length()) {
          Media.pause()
          Phrases.push({
                        timingStart:  prevPhrase.timingEnd,
                        timingEnd: Media.getCurrentTime().toFixed(2),
                        text: ""
                        })
      }

      else {
        Phrases.updatePhrase(curPhraseNum, {
                          "timingStart": prevPhrase.timingEnd,
                          "timingEnd": Media.getCurrentTime().toFixed(2)
                        })
      }


    }

    tag.nextClicked = function(){
      var cf = Phrases.getCurrentPhraseNum()
      Media.playPhrase(cf+1)
    }

    tag.prevClicked = function(){
      var cf = Phrases.getCurrentPhraseNum()
      Media.playPhrase(cf-1)
    }

    tag.repeatClicked = function(){
      var cf = Phrases.getCurrentPhraseNum()
      Media.playPhrase(cf)
    }

    Phrases.on("currentPhraseChanged", function(phraseNum){
        tag.currentPhraseNum = phraseNum
        try {
          tag.subs = Phrases.getPhrase(phraseNum).text
        }
        catch(e){}
        tag.update()

      })

  </script>


</MediaInput>
